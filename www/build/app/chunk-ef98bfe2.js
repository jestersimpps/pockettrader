/*! Built with http://stenciljs.com */
const{h:e}=window.App;import{a as t,b as a}from"./chunk-d4e5ef20.js";var r,n;!function(e){e.LIMITSELL="LIMITSELL",e.LIMITBUY="LIMITBUY",e.MARKETSELL="MARKETSELL",e.MARKETBUY="MARKETBUY",e.CANCEL="CANCEL"}(r||(r={})),function(e){e.open="open",e.filled="filled",e.cancelled="cancelled",e.closed="closed",e.failed="failed"}(n||(n={}));const s=new class{constructor(){this.currencies=[{id:"mBTC",symbol:"mBTC",conversionRate:1e3},{id:"BTC",symbol:"BTC",conversionRate:1},{id:"EUR",symbol:"€",conversionRate:null},{id:"USD",symbol:"$",conversionRate:null},{id:"GBP",symbol:"£",conversionRate:null}]}getBaseCurrencyFromStorage(){return t.get("basecurrency")}getConversionRates(){return axios.get("https://api.coindesk.com/v1/bpi/currentprice.json").then(e=>(this.currencies.map(t=>{switch(t.id){case"USD":t.conversionRate=+e.data.bpi.USD.rate_float;break;case"EUR":t.conversionRate=+e.data.bpi.EUR.rate_float;break;case"GBP":t.conversionRate=+e.data.bpi.GBP.rate_float}}),t.set("currencies",this.currencies),this.currencies))}setBaseCurrency(e){t.set("basecurrency",e)}convertToBase(e,t){return e*this.currencies.find(e=>e.id===t.id).conversionRate}getBaseTotal(e,t){let a=0;return e.forEach(e=>{a+=e.btcAmount}),this.convertToBase(a,t)}},c=new class{getTotalBalancesFromStorage(){return t.get("totalbalances")}getBalancesFromStorage(){return t.get("balances")}getLatestTotal(e){return e.length?e[e.length-1][1]:0}setTotalBalances(e){t.set("totalbalances",e)}setBalances(e){t.set("balances",e)}getBalances(e){return axios.post(`https://lightningassets.com/exchangeapi/${e.id}/balances/get`,{key:e.key,secret:e.secret})}refreshBalances(e,t,a,r){let o=[],i=[],g=[],d=[],u=[],h=e.filter(e=>e.balance>0),p=t.filter(e=>e.key&&e.secret);p.forEach(e=>{o.push(e.id),i.push(l.getTickers(e.id)),g.push(c.getBalances(e))}),h.forEach(e=>d.push(l.getCoinmarketcapTicker(e.id)));let m={conversionrates:null,tickers:null,wallets:null,orders:null,exchanges:null,exchangeTotal:0,walletTotal:0};return s.getConversionRates().then(e=>(m.conversionrates=e,Promise.all(i).then(e=>Promise.all(d).then(s=>Promise.all(g).then(c=>{for(let t=0;t<o.length;t++)u[t]={exchangeId:o[t],tickers:e[t].data},p[t].balances=c[t].data.map(a=>{const r=this.getBtcStats(a,e[t].data);return m.exchangeTotal+=r.amount,{btcAmount:r.amount,balance:a.balance,pending:a.pending,available:a.available,currency:a.currency,btcPrice:r.price,change:r.change}}).filter(e=>+e.btcAmount>r);a.filter(e=>e.status!=n.cancelled).map(e=>{let t=u.find(t=>t.exchangeId===e.exchangeId).tickers.find(t=>t.symbol===e.pair);return e.last=t.last,console.log(e),e});for(let e=0;e<h.length;e++)h[e].btcPrice=+s[e].data.data.quotes.BTC.price,h[e].btcAmount=+h[e].balance*+s[e].data.data.quotes.BTC.price,h[e].change=+s[e].data.data.quotes.BTC.percent_change_24h,m.walletTotal+=+h[e].balance*+s[e].data.data.quotes.BTC.price;return m.tickers=u,m.orders=a.filter(e=>e.orderId),m.wallets=h,m.exchanges=t.map(e=>{return p.find(t=>t.id===e.id)||e}),m}).catch(()=>(window.alert("Error fetching balance data, please check API keys"),null))).catch(()=>(window.alert("Error fetching wallet data, please check internet connection"),null))).catch(()=>(window.alert("Error fetching ticker data, please check internet connection"),null)))).catch(()=>(window.alert("Error fetching conversionrates, please check internet connection"),null))}getBtcStats(e,t){let a={price:0,amount:0,change:0,last:0,symbol:null};const r=t.find(t=>t.symbol===`${e.currency}/BTC`),n=t.find(t=>t.symbol===`BTC/${e.currency}`);return"BTC"===e.currency&&(a.amount=e.balance,a.price=1),r&&(a.amount=e.balance*r.last,a.price=r.last,a.change=r.percentage,a.symbol=r.symbol),n&&(a.amount=e.balance/n.last,a.price=1/n.last,a.change=n.percentage,a.symbol=n.symbol),a}},o=new a,l=new class{getTickersFromStorage(){return t.get("tickers")}setTickers(e){return t.set("tickers",e)}getTickers(e){return axios.get(`https://lightningassets.com/exchangeapi/${e}/tickers`)}getTicker(e,t){return axios.get(`https://lightningassets.com/exchangeapi/${e}/ticker/data?symbol=${t}`)}getCoinmarketcapTicker(e){return axios.get(`https://api.coinmarketcap.com/v2/ticker/${e}/?convert=BTC`)}},i=new class{getWalletsFromStorage(){return t.get("wallets")}setWallets(e){return t.set("wallets",e)}getCoinmarketCapListings(){return axios.get("https://api.coinmarketcap.com/v2/listings/")}},g=new class{constructor(){}getTokenFromStorage(){return t.get("token")}setToken(e){return t.set("token",e)}generateNewToken(){let e=(new Date).getTime();return new Hashids(`token-${e}`,8).encode(1,2,3)}},d=new class{getOrdersFromStorage(){return t.get("orders")}setOrders(e){return t.set("orders",e)}newOrder(e,t){return axios.post(`https://lightningassets.com/exchangeapi/${e.id}/orders/create`,t)}getOrder(e,t,a){return axios.post(`https://lightningassets.com/exchangeapi/${e.id}/orders/get`,{pair:a,orderId:t,clientCreds:{key:e.key,secret:e.secret}})}cancelOrder(e,t,a){return axios.post(`https://lightningassets.com/exchangeapi/${e.id}/orders/cancel`,{pair:a,orderId:t,clientCreds:{key:e.key,secret:e.secret}})}getOhlc(e,t,a="1h"){return axios.get(`https://lightningassets.com/exchangeapi/${e}/ticker/ohlc?symbol=${t}&timeframe=${a}`)}};export{s as a,l as b,c,n as d,d as e,r as f,i as g,g as h,o as i};