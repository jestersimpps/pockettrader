/*! Built with http://stenciljs.com */
const{h:e}=window.App;import{a as t,c as a}from"./chunk-ef98bfe2.js";import{d as s,a as n,e as r,f as c,g as i,c as o,h as l,i as p}from"./chunk-6a7807b8.js";import"./chunk-d4e5ef20.js";class h{constructor(){this.exchanges=[],this.isLoading=!1}componentWillLoad(){this.store.mapStateToProps(this,e=>{const{app:{exchanges:t,baseCurrency:a,currencies:s,tickers:n,wallets:r,balances:c,orders:i,dust:o}}=e;return{exchanges:t,baseCurrency:a,currencies:s,tickers:n,wallets:r,balances:c,orders:i,dust:o}}),this.store.mapDispatchToProps(this,{appSetExchanges:s,appSetBaseCurrency:n,appSetCurrencies:r,appSetTickers:c,appSetTotalBalances:i,appSetWallets:o,appSetBalances:l,appSetOrders:p})}addTotalBalance(e){a.getTotalBalancesFromStorage().then(t=>{if(e&&e>0){let s=Math.round((new Date).getTime());a.setTotalBalances([...t,[s,e]]),this.appSetTotalBalances([...t,[s,e]])}})}getBtcStats(e,t){let a={price:0,balance:0,change:0};const s=t.find(t=>t.symbol===`${e.currency}/BTC`);return"BTC"===e.symbol&&(a.balance=e.balance,a.price=1),s&&(a.balance=e.balance*s.last,a.price=s.last,a.change=s.percentage),a}refreshBalances(){this.isLoading=!0,a.refreshBalances(this.wallets,this.exchanges,this.orders,this.dust).then(e=>{e&&(this.appSetCurrencies(e.conversionrates),this.appSetTickers(e.tickers),this.appSetWallets(e.wallets),this.appSetExchanges(e.exchanges),this.addTotalBalance(e.exchangeTotal+e.walletTotal),this.appSetBalances({overview:e.exchangeTotal+e.walletTotal,exchanges:e.exchangeTotal,wallets:e.walletTotal}),this.appSetOrders(e.orders)),this.isLoading=!1})}render(){return[e("ion-header",null,e("ion-toolbar",{color:"dark"},e("ion-buttons",{slot:"start"},e("ion-button",{"icon-only":!0,href:"/settings",padding:!0},e("ion-icon",{name:"options"}))),e("ion-title",{"text-center":!0},e("ion-badge",{color:"light"},e("app-baseprice",{btcPrice:t.convertToBase(this.balances.exchanges,this.baseCurrency),baseCurrency:this.baseCurrency}))),e("ion-buttons",{slot:"end"},e("ion-button",{"icon-only":!0,disabled:this.isLoading,onClick:()=>this.refreshBalances(),padding:!0},e("ion-icon",{name:"refresh",class:this.isLoading?"spin":""}))))),e("ion-content",null,e("ion-list",null,this.exchanges.filter(e=>e.key&&e.secret).map(a=>[e("ion-item-divider",{color:"light"},e("ion-label",null,a.id),e("ion-badge",{slot:"end",color:"light"},e("app-baseprice",{btcPrice:t.getBaseTotal(a.balances,this.baseCurrency),baseCurrency:this.baseCurrency}))),a.balances.sort((e,t)=>t.btcAmount-e.btcAmount).map(t=>e("app-balanceitem",{exchangeId:a.id,baseCurrency:this.baseCurrency,cryptodata:t}))])))]}static get is(){return"app-exchanges"}static get properties(){return{balances:{state:!0},baseCurrency:{state:!0},dust:{state:!0},exchanges:{state:!0},isLoading:{state:!0},orders:{state:!0},store:{context:"store"},tickers:{state:!0},wallets:{state:!0}}}static get style(){return""}}export{h as AppExchanges};