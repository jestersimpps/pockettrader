/*! Built with http://stenciljs.com */
const{h:e}=window.App;import{c as t,a}from"./chunk-ef98bfe2.js";import{d as n,a as s,e as r,f as c,g as i,c as l,h as o,i as h}from"./chunk-6a7807b8.js";import{a as p}from"./chunk-c2f0607d.js";import{a as d}from"./chunk-f8b49345.js";import"./chunk-d4e5ef20.js";class u{constructor(){this.exchanges=[],this.isLoading=!1}componentWillLoad(){this.store.mapStateToProps(this,e=>{const{app:{exchanges:t,baseCurrency:a,currencies:n,tickers:s,wallets:r,balances:c,orders:i,dust:l}}=e;return{exchanges:t,baseCurrency:a,currencies:n,tickers:s,wallets:r,balances:c,orders:i,dust:l}}),this.store.mapDispatchToProps(this,{appSetExchanges:n,appSetBaseCurrency:s,appSetCurrencies:r,appSetTickers:c,appSetTotalBalances:i,appSetWallets:l,appSetBalances:o,appSetOrders:h});let e=this.wallets.filter(e=>e.balance>0),t=this.exchanges.filter(e=>e.key&&e.secret);this.showTutorial=e.length+t.length===0}addTotalBalance(e){t.getTotalBalancesFromStorage().then(a=>{if(e&&e>0){let n=Math.round((new Date).getTime());t.setTotalBalances([...a,[n,e]]),this.appSetTotalBalances([...a,[n,e]])}})}getBtcStats(e,t){let a={price:0,balance:0,change:0};const n=t.find(t=>t.symbol===`${e.currency}/BTC`);return"BTC"===e.symbol&&(a.balance=e.balance,a.price=1),n&&(a.balance=e.balance*n.last,a.price=n.last,a.change=n.percentage),a}refreshBalances(){this.isLoading=!0,t.refreshBalances(this.wallets,this.exchanges,this.orders,this.dust).then(e=>{e&&(this.appSetCurrencies(e.conversionrates),this.appSetTickers(e.tickers),this.appSetWallets(e.wallets),this.appSetExchanges(e.exchanges),this.addTotalBalance(e.exchangeTotal+e.walletTotal),this.appSetBalances({overview:e.exchangeTotal+e.walletTotal,exchanges:e.exchangeTotal,wallets:e.walletTotal}),this.appSetOrders(e.orders)),this.isLoading=!1})}render(){return[e("ion-header",null,e("ion-toolbar",{color:"dark"},e("ion-buttons",{slot:"start"},e("ion-button",{"icon-only":!0,href:"/settings",padding:!0},e("ion-icon",{name:"options"}))),e("ion-title",{"text-center":!0},e("ion-badge",{color:"light"},e("app-baseprice",{btcPrice:a.convertToBase(this.balances.overview,this.baseCurrency),baseCurrency:this.baseCurrency}))),e("ion-buttons",{slot:"end"},e("ion-button",{"icon-only":!0,disabled:this.isLoading,onClick:()=>this.refreshBalances(),padding:!0},e("ion-icon",{name:"refresh",class:this.isLoading?"spin":""}))))),e("ion-content",null,this.isLoading?e("div",{class:"progress","text-center":!0},e("ion-icon",{name:"sync",class:"spin"})):this.showTutorial?[e("div",null,e("p",null,"Welcome to Pocket Trader!"),e("ion-button",{expand:"block",color:"light",href:"/settings/tutorial"},"View tutorial"))]:e("ion-list",null,e("ion-list-header",{color:"light"},"Distribution & 24h Change"),e("app-sunburst",{exchanges:this.exchanges,wallets:this.wallets,totalBalance:this.balances.overview,baseCurrency:this.baseCurrency}),e("ion-list-header",{color:"light"},"Total Balance (",this.baseCurrency.id,")"),e("app-splinechart",null)))]}static get is(){return"app-overview"}static get properties(){return{balances:{state:!0},baseCurrency:{state:!0},dust:{state:!0},exchanges:{state:!0},isLoading:{state:!0},orders:{state:!0},showTutorial:{state:!0},store:{context:"store"},tickers:{state:!0},wallets:{state:!0}}}static get style(){return""}}class b{componentWillLoad(){this.store.mapStateToProps(this,e=>{const{app:{baseCurrency:t,totalBalances:a}}=e;return{baseCurrency:t,totalBalances:a}})}componentDidLoad(){this.chart=p.stockChart("spline",{title:{text:""},rangeSelector:{inputEnabled:!1,selected:2,buttons:[{type:"minute",count:60,text:"1h"},{type:"day",count:1,text:"1d"},{type:"week",count:1,text:"1w"},{type:"month",count:1,text:"1m"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}]},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b",year:"%b"},title:{text:""}},yAxis:{title:{text:`Balance (${this.baseCurrency.symbol})`}},tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:`<b>Time:</b> {point.x:%e %b %Y, %H:%M}<br><b>Balance:</b> ${this.baseCurrency.symbol} {point.y:.8f} `},plotOptions:{spline:{marker:{enabled:!0,radius:2}}},legend:{enabled:!1},colors:["#000"],series:[{name:`Total ${this.baseCurrency.id} Balance over time`,data:this.balancePoints()}]})}balancePoints(){const e=[];return this.totalBalances.forEach(t=>{e.push([t[0],+a.convertToBase(t[1],this.baseCurrency)])}),e}render(){return[e("div",{id:"spline",class:"chart"})]}static get is(){return"app-splinechart"}static get properties(){return{baseCurrency:{state:!0},store:{context:"store"},totalBalances:{state:!0}}}static get style(){return".chart{height:400px}"}}class g{constructor(){this.exchanges=[],this.wallets=[]}componentDidLoad(){const e={name:`${this.baseCurrency.symbol} ${d(a.convertToBase(this.totalBalance,this.baseCurrency)).format("BTC"===this.baseCurrency.id?"0,0.0000":"0,0.00")}`,change:0,children:[...this.exchanges.map(e=>({name:e.id,balance:e.balances.reduce((e,t)=>e+t.balance,0),value:e.balances.reduce((e,t)=>e+t.btcAmount,0),change:e.balances.reduce((e,t)=>e+t.change*t.btcAmount,0)/e.balances.reduce((e,t)=>e+t.btcAmount,0),children:e.balances.map(e=>({name:e.currency,size:e.btcAmount,balance:e.balance,value:e.btcAmount,change:e.change}))})),{name:"Wallets",balance:this.wallets.reduce((e,t)=>e+t.balance,0),value:this.wallets.reduce((e,t)=>e+t.btcAmount,0),change:this.wallets.reduce((e,t)=>e+t.change*t.btcAmount,0)/this.wallets.reduce((e,t)=>e+t.btcAmount,0),children:this.wallets.map(e=>({name:e.currency,size:e.btcAmount,balance:e.balance,value:e.btcAmount,change:e.change}))}]},t=window.innerWidth,n=window.innerHeight,s=Math.min(t,n)/1.4,r=Math.max(...this.exchanges.map(e=>Math.max(...e.balances.map(e=>e.change)))),c=Math.min(...this.exchanges.map(e=>Math.min(...e.balances.map(e=>e.change))));let i=d3.scaleLinear().domain([c,0,r]).range(["#f53d3d","#fff","#10dc60"]);const l=d3.scaleLinear().range([0,2*Math.PI]).clamp(!0),o=d3.scaleLinear().range([.1*s,s]),h=d3.partition(),p=e=>{const t=Math.PI/2,a=[l(e.x0)-t,l(e.x1)-t],n=Math.max(0,(o(e.y0)+o(e.y1))/2),s=(a[1]+a[0])/2,r=s>0&&s<Math.PI;r&&a.reverse();const c=d3.path();return c.arc(0,0,n,a[0],a[1],r),c.toString()},u=e=>{const t=l(e.x1)-l(e.x0),a=Math.max(0,(o(e.y0)+o(e.y1))/2);return 6*e.data.name.length<a*t},b=d3.select("#sunburst-chart").append("svg").style("width","100vw").style("height","400px").style("background","#fff").attr("viewBox",`${-t/2} ${-n/2} ${t} ${n}`).on("click",()=>x()),g=d3.hierarchy(e).sum(function(e){return e.size}),m=b.selectAll("g.slice").data(h(g).descendants()).enter().append("g").attr("class","slice").on("click",e=>{d3.event.stopPropagation(),x(e)}),y=d3.arc().startAngle(e=>l(e.x0)).endAngle(e=>l(e.x1)).innerRadius(e=>Math.max(0,o(e.y0))).outerRadius(e=>Math.max(0,o(e.y1)));function x(e={x0:0,x1:1,y0:0,y1:1}){const t=b.transition().duration(500).tween("scale",()=>{const t=d3.interpolate(l.domain(),[e.x0,e.x1]),a=d3.interpolate(o.domain(),[e.y0,1]);return e=>{l.domain(t(e)),o.domain(a(e))}});t.selectAll("path.main-arc").attrTween("d",e=>()=>y(e)),t.selectAll("path.hidden-arc").attrTween("d",e=>()=>p(e)),t.selectAll("text").attrTween("display",e=>()=>u(e)?null:"none"),function e(t){b.selectAll(".slice").filter(e=>e===t).each(function(t){this.parentNode.appendChild(this),t.parent&&e(t.parent)}).transition().duration(500)}(e)}m.append("path").attr("class","main-arc").attr("fill",e=>i(e.data.change)).transition().duration(function(e){return 2e3*(e.y1-e.y0)}).attrTween("d",function(e){var t=d3.interpolate(e.x0,e.x1);return function(a){return e.x1=t(a),y(e)}}),m.append("path").attr("class","hidden-arc").attr("id",(e,t)=>`hiddenArc${t}`).attr("d",p),m.append("text").style("stroke","#000").attr("fill","#000").style("font-size","1.2rem").append("textPath").attr("startOffset","50%").attr("xlink:href",(e,t)=>`#hiddenArc${t}`).text(e=>0!=e.data.change?`${e.data.name} (${d(e.data.change).format("0.0")}%)`:"")}render(){return[e("div",{id:"sunburst-chart"})]}static get is(){return"app-sunburst"}static get properties(){return{baseCurrency:{type:"Any",attr:"base-currency"},exchanges:{type:"Any",attr:"exchanges"},totalBalance:{type:Number,attr:"total-balance"},wallets:{type:"Any",attr:"wallets"}}}static get style(){return".slice{cursor:pointer}.slice .main-arc{stroke:#fff;stroke-width:5px}.slice .hidden-arc{fill:none}.slice text{pointer-events:none;text-anchor:middle}"}}export{u as AppOverview,b as AppSplinechart,g as AppSunburst};