/*! Built with http://stenciljs.com */
const{h:t}=window.App;import{b as e,c as i,e as n,d as o,f as s}from"./chunk-ef98bfe2.js";import{a}from"./chunk-f8b49345.js";import{d as r,a as l,e as c,f as h,g as d,c as u,h as m,i as g}from"./chunk-6a7807b8.js";import"./chunk-d4e5ef20.js";class p{constructor(){this.pairs=[],this.isLoading=!1,this.tradePrice=0,this.tradeAmount=0,this.tradeAction=s.LIMITBUY,this.baseBalance=0,this.quoteBalance=0,this.step=0}componentWillLoad(){this.store.mapStateToProps(this,t=>{const{app:{exchanges:e,baseCurrency:i,currencies:n,tickers:o,dust:s,wallets:a,orders:r}}=t;return{exchanges:e,baseCurrency:i,currencies:n,tickers:o,wallets:a,orders:r,dust:s}}),this.store.mapDispatchToProps(this,{appSetExchanges:r,appSetBaseCurrency:l,appSetCurrencies:c,appSetTickers:h,appSetTotalBalances:d,appSetWallets:u,appSetBalances:m,appSetOrders:g}),this.tickers.length&&(this.pairs=this.tickers[0].tickers.sort((t,e)=>{let i="",n="1";return t.symbol&&e.symbol&&(i=t.symbol.toUpperCase(),n=e.symbol.toUpperCase()),i<n?-1:i>n?1:0}),this.exchangeId=this.tickers[0].exchangeId,this.selectedExchange=this.tickers[0].exchangeId,this.getNewTicker(this.exchangeId,this.pairs[0].symbol))}exchangeSelected(t){this.exchangeId=t.target.value,this.selectedExchange=t.target.value,this.pairs=this.tickers.find(e=>e.exchangeId===t.target.value).tickers.sort((t,e)=>{let i="",n="1";return t.symbol&&e.symbol&&(i=t.symbol.toUpperCase(),n=e.symbol.toUpperCase()),i<n?-1:i>n?1:0}),this.getNewTicker(this.exchangeId,this.pairs[0].symbol)}pairSelected(t,e){this.getNewTicker(t,e)}getBalances(t,e){let i=this.exchanges.find(t=>t.id===this.exchangeId),n=i.balances.find(e=>e.currency===t),o=i.balances.find(t=>t.currency===e);this.quoteBalance=0,this.baseBalance=0,n&&(this.quoteBalance=n.available),o&&(this.baseBalance=o.available)}setPriceWithButtons(t){let e=this.tradePrice/100,i=this.tradePrice/1e3;switch(t){case"--":this.tradePrice-=e;break;case"-":this.tradePrice-=i;break;case"+":this.tradePrice+=i;break;case"++":this.tradePrice+=e}}getAmountFormat(){let t=[];for(let e=0;e<this.ticker.info.precision.amount;e++)t.push("0");return`0.${t.join("")}`}getPriceFormat(){let t=[];for(let e=0;e<this.ticker.info.precision.price;e++)t.push("0");return`0.${t.join("")}`}getNewTicker(t,i){this.isLoading=!0,e.getTicker(t,i).then(e=>{this.exchangeId=t,this.ticker=e.data,this.tradePrice=+e.data.last,this.getBalances(e.data.quote,e.data.base),this.isLoading=!1}).catch(()=>{window.alert(`Something went wrong while getting ticker data for ${t} - ${i}`),this.isLoading=!1})}setTradePrice(t){this.tradePrice=+t.target.value}setTradeAmount(t){this.tradeAmount=+t.target.value}roundNumber(t,e,i){let n=Math.pow(10,e),o=t*n,s=0;return i?(o=-o,s=-1*Math.round(o)):s=Math.round(o),s/n}setTradeAmountByButton(t){let e=0;switch(this.tradeAction){case s.LIMITBUY:case s.MARKETBUY:this.checkAmounts(e=this.quoteBalance*t/this.tradePrice)&&(this.tradeAmount=(+e*+this.tradePrice-this.getFee(e,this.tradePrice))/this.tradePrice);break;case s.LIMITSELL:case s.MARKETSELL:this.checkAmounts(e=this.baseBalance*t)&&(this.tradeAmount=(+e*+this.tradePrice-this.getFee(e,this.tradePrice))/this.tradePrice)}}getFee(t,e){return this.tradeAction===s.LIMITBUY||this.tradeAction===s.LIMITSELL?+this.ticker.info.maker*+t*+e:+this.ticker.info.taker*+t*+e}checkAmounts(t){return this.ticker.info.limits.amount.min>t?(window.alert(`Minimum amount of ${this.ticker.info.limits.amount.min}`),this.tradeAmount=this.ticker.info.limits.amount.min,!1):!(this.ticker.info.limits.amount.max<t&&(window.alert(`Maximum amount of ${this.ticker.info.limits.amount.max}`),this.tradeAmount=this.ticker.info.limits.amount.max,1))}getSymbol(t,e){let n=this.tickers.find(t=>t.exchangeId===e.id).tickers;return i.getBtcStats(t,n).symbol}refreshBalances(){this.isLoading=!0,i.refreshBalances(this.wallets,this.exchanges,this.orders,this.dust).then(t=>{t&&(this.appSetCurrencies(t.conversionrates),this.appSetTickers(t.tickers),this.appSetWallets(t.wallets),this.appSetExchanges(t.exchanges),this.addTotalBalance(t.exchangeTotal+t.walletTotal),this.appSetBalances({overview:t.exchangeTotal+t.walletTotal,exchanges:t.exchangeTotal,wallets:t.walletTotal}),this.appSetOrders(t.orders)),this.isLoading=!1})}addTotalBalance(t){i.getTotalBalancesFromStorage().then(e=>{if(t&&t>0){let n=Math.round((new Date).getTime());i.setTotalBalances([...e,[n,t]]),this.appSetTotalBalances([...e,[n,t]])}})}render(){return[t("ion-header",null,t("ion-toolbar",{color:"dark"},t("ion-buttons",{slot:"start"},t("ion-button",{"icon-only":!0,href:"/settings",padding:!0},t("ion-icon",{name:"options"}))),t("ion-title",{"text-center":!0},"Trade"),t("ion-buttons",{slot:"end"},t("ion-button",{"icon-only":!0,disabled:this.isLoading,onClick:()=>this.refreshBalances(),padding:!0},t("ion-icon",{name:"refresh",class:this.isLoading?"spin":""})))),this.ticker&&[t("ion-segment",{color:"dark",onIonChange:t=>this.step=+t.detail.value},t("ion-segment-button",{value:"0",checked:0===this.step},"Pair"),t("ion-segment-button",{value:"1",checked:1===this.step},"Price"),t("ion-segment-button",{value:"2",checked:2===this.step},"Action"),t("ion-segment-button",{value:"3",checked:3===this.step},"Amount"),t("ion-segment-button",{value:"4",checked:4===this.step},"Summary"))]),this.ticker?t("ion-content",null,t("ion-list",null,0===this.step&&[t("ion-list-header",{color:"light"},t("ion-title",{"text-center":!0},this.isLoading?t("ion-icon",{name:"sync",class:"spin"}):t("ion-badge",{color:"light"},this.exchangeId," - ",this.ticker.symbol))),t("ion-item-divider",{color:"light"},"Select from all pairs:"),t("ion-item",{lines:"none"},t("ion-label",null,"Select Exchange"),t("select",{onChange:t=>this.exchangeSelected(t)},this.exchanges.filter(t=>t.key&&t.secret).map(e=>t("option",{value:e.id},e.id)))),t("ion-item",{lines:"none"},t("ion-label",null,"Select Pair"),t("select",{onChange:t=>this.pairSelected(this.selectedExchange,t.target.value)},this.pairs.map(e=>t("option",{value:e.symbol},e.symbol)))),t("ion-item-divider",{color:"light"},"Select from holdings:"),this.exchanges.filter(t=>t.key&&t.secret).map(e=>[e.balances.filter(t=>"BTC"!=t.currency).map(i=>[t("ion-item",{lines:"full",onClick:()=>this.pairSelected(e.id,this.getSymbol(i,e))},t("ion-label",{"text-left":!0},e.id),t("ion-label",{"text-right":!0},this.getSymbol(i,e)))])])],1===this.step&&t("div",null,t("ion-list-header",{color:"light"},t("ion-title",{"text-center":!0},this.isLoading?t("ion-icon",{name:"sync",class:"spin"}):t("ion-badge",{color:"light"},a(+this.tradePrice).format(this.getPriceFormat())," ",this.ticker.symbol))),t("app-ohlc",{exchangeId:this.exchangeId,symbol:this.ticker.symbol,altPrice:this.tradePrice,curPrice:this.ticker.last}),t("ion-item",{lines:"none"},t("ion-label",null,"Last price"),t("ion-label",null,t("ion-button",{size:"small",color:"dark",expand:"block","text-right":!0,onClick:()=>this.tradePrice=this.ticker.last},a(+this.ticker.last).format(this.getPriceFormat())," ",this.ticker.symbol))),t("ion-item",{lines:"full"},t("ion-label",null,"Set price:"),t("ion-input",{clearInput:!0,name:"price",type:"number",value:`${this.tradePrice}`,onInput:t=>this.setTradePrice(t)})),t("ion-grid",null,t("ion-row",null,t("ion-col",null,t("ion-button",{expand:"block",color:"danger",onClick:()=>this.setPriceWithButtons("--")},"- -")),t("ion-col",null,t("ion-button",{expand:"block",color:"danger",onClick:()=>this.setPriceWithButtons("-")},"-")),t("ion-col",null,t("ion-button",{expand:"block",color:"success",onClick:()=>this.setPriceWithButtons("+")},"+")),t("ion-col",null,t("ion-button",{expand:"block",color:"success",onClick:()=>this.setPriceWithButtons("++")},"+ +"))))),2===this.step&&[t("ion-list-header",{color:"light"},t("ion-title",{"text-center":!0},t("ion-badge",{color:"light"},this.tradeAction))),t("ion-grid",null,t("ion-row",null,t("ion-col",null,t("ion-button",{expand:"block",color:"success",onClick:()=>this.tradeAction=s.LIMITBUY},"Limit Buy")),t("ion-col",null,t("ion-button",{expand:"block",color:"danger",onClick:()=>this.tradeAction=s.LIMITSELL},"Limit Sell"))))],3===this.step&&[t("ion-list-header",{color:"light"},t("ion-title",{"text-center":!0},this.isLoading?t("ion-icon",{name:"sync",class:"spin"}):t("ion-badge",{color:"light"},a(this.tradeAmount).format(this.getAmountFormat())," ",this.ticker.base))),(this.tradeAction===s.LIMITBUY||this.tradeAction===s.MARKETBUY)&&t("ion-item",{lines:"none"},t("ion-label",null,"Available ",this.ticker.quote),t("ion-label",null,t("ion-button",{size:"small",color:"dark",expand:"block","text-right":!0,onClick:()=>this.setTradeAmountByButton(1)},a(+this.quoteBalance).format(this.getAmountFormat())))),(this.tradeAction===s.LIMITSELL||this.tradeAction===s.MARKETSELL)&&t("ion-item",{lines:"none"},t("ion-label",null,"Available ",this.ticker.base),t("ion-label",null,t("ion-button",{size:"small",color:"dark",expand:"block","text-right":!0,onClick:()=>this.setTradeAmountByButton(1)},a(+this.baseBalance).format(this.getAmountFormat())))),t("ion-item",{lines:"full"},t("ion-label",null,"Set Amount:"),t("ion-input",{clearInput:!0,name:"amount",type:"number",value:`${this.tradeAmount}`,onInput:t=>this.setTradeAmount(t),onBlur:()=>this.checkAmounts(this.tradeAmount)})),t("ion-grid",null,t("ion-row",null,t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.1)},"10%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.2)},"20%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.3)},"30%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.4)},"40%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.5)},"50%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.6)},"60%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.7)},"70%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.8)},"80%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(.9)},"90%")),t("ion-col",{"col-6":!0},t("ion-button",{expand:"block",color:"light",onClick:()=>this.setTradeAmountByButton(1)},"100%"))))],4===this.step&&[t("ion-list-header",{color:"light"},t("ion-title",{"text-center":!0},t("ion-badge",{color:"light"},"Order summary"))),t("ion-item",{lines:"none"},t("ion-label",null,"Exchange"),t("ion-label",{"text-right":!0},this.ticker.exchange)),t("ion-item",{lines:"none"},t("ion-label",null,"Pair"),t("ion-label",{"text-right":!0},this.ticker.symbol)),t("ion-item",{lines:"full"},t("ion-label",null,"Action"),t("ion-label",{"text-right":!0},this.tradeAction)),t("ion-item",{lines:"none"},t("ion-label",null,"Amount"),t("ion-label",{"text-right":!0},a(this.tradeAmount).format(this.getAmountFormat())," ",this.ticker.base)),t("ion-item",{lines:"none"},t("ion-label",null,"Price"),t("ion-label",{"text-right":!0},a(+this.tradePrice).format(this.getPriceFormat())," ",this.ticker.symbol)),t("ion-item",{lines:"full"},t("ion-label",null,"Fee"),t("ion-label",{"text-right":!0},a(this.getFee(this.tradeAmount,this.tradePrice)).format(this.getPriceFormat())," ",this.ticker.quote)),t("ion-item",{lines:"none"},t("ion-label",null,"Total"),t("ion-label",{"text-right":!0},a(+this.tradeAmount*+this.tradePrice-this.getFee(this.tradeAmount,this.tradePrice)).format(this.getAmountFormat())," ",this.ticker.quote)),t("ion-button",{expand:"full",color:"success",onClick:()=>this.executeOrder(this.ticker.symbol,this.tradeAction,this.tradePrice,this.tradeAmount),disabled:this.isLoading},this.isLoading&&t("ion-icon",{name:"refresh",class:"spin","margin-right":!0})," Execute")])):t("ion-content",{padding:!0},"Loading exchanges...")]}executeOrder(t,e,i,r){if(window.confirm("Are you sure you want to place this order?")){this.isLoading=!0;let l=this.exchanges.find(t=>t.id===this.exchangeId);n.newOrder(l,{pair:t,type:e,price:a(i).format(this.getPriceFormat()),amount:a(r).format(this.getAmountFormat()),clientCreds:{key:l.key,secret:l.secret}}).then(n=>{if(n.data.id){window.alert(`Placed order:\n\n                      Pair: ${t}\n\n                      Type: ${e}\n\n                      Price: ${a(i).format(this.getPriceFormat())}\n\n                      amount:${a(r).format(this.getAmountFormat())}`);let c={exchangeId:l.id,pair:t,type:e,status:o.open,orderId:n.data.id,openPrice:a(i).format(this.getPriceFormat()),last:a(this.ticker.last).format(this.getPriceFormat()),closePrice:0,filled:0,remaining:0,amount:a(r).format(this.getAmountFormat()),fee:this.tradeAction===s.LIMITBUY||this.tradeAction===s.LIMITSELL?a(+this.ticker.info.maker*+this.tradeAmount*+this.tradePrice).format(this.getPriceFormat()):a(+this.ticker.info.taker*+this.tradeAmount*+this.tradePrice).format(this.getPriceFormat()),createdAt:(new Date).getTime()/1e3,updatedAt:(new Date).getTime()/1e3};this.appSetOrders([...this.orders,c]),this.isLoading=!1}else this.isLoading=!1,window.alert("Something went wrong while executing the order.")}).catch(t=>{this.isLoading=!1,window.alert(`Something went wrong while executing the order: ${t.message}`)})}}static get is(){return"app-trade"}static get properties(){return{baseBalance:{state:!0},dust:{state:!0},exchangeId:{state:!0},exchanges:{state:!0},isLoading:{state:!0},orders:{state:!0},pairs:{state:!0},quoteBalance:{state:!0},selectedExchange:{state:!0},step:{state:!0},store:{context:"store"},ticker:{state:!0},tickers:{state:!0},tradeAction:{state:!0},tradeAmount:{state:!0},tradePrice:{state:!0},wallets:{state:!0}}}static get style(){return".full{width:100%}"}}export{p as AppTrade};