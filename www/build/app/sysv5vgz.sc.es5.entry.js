/*! Built with http://stenciljs.com */
App.loadBundle("sysv5vgz",["exports","./chunk-4c3efb41.js","./chunk-b5724922.js","./chunk-50c69dbd.js","./chunk-468533f7.js"],function(t,e,n,i,o){var r=window.App.h,a=function(){function t(){this.pairs=[],this.isLoading=!1,this.tradePrice=0,this.tradeAmount=0,this.tradeAction=e.OrderType.LIMITBUY,this.baseBalance=0,this.quoteBalance=0,this.step=0}return t.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(t){var e=t.app;return{exchanges:e.exchanges,baseCurrency:e.baseCurrency,currencies:e.currencies,tickers:e.tickers,wallets:e.wallets,orders:e.orders,dust:e.dust}}),this.store.mapDispatchToProps(this,{appSetExchanges:i.appSetExchanges,appSetBaseCurrency:i.appSetBaseCurrency,appSetCurrencies:i.appSetCurrencies,appSetTickers:i.appSetTickers,appSetTotalBalances:i.appSetTotalBalances,appSetWallets:i.appSetWallets,appSetBalances:i.appSetBalances,appSetOrders:i.appSetOrders}),this.tickers.length&&(this.pairs=this.tickers[0].tickers.sort(function(t,e){var n="",i="1";return t.symbol&&e.symbol&&(n=t.symbol.toUpperCase(),i=e.symbol.toUpperCase()),n<i?-1:n>i?1:0}),this.exchangeId=this.tickers[0].exchangeId,this.selectedExchange=this.tickers[0].exchangeId,this.getNewTicker(this.exchangeId,this.pairs[0].symbol))},t.prototype.exchangeSelected=function(t){this.exchangeId=t.target.value,this.selectedExchange=t.target.value,this.pairs=this.tickers.find(function(e){return e.exchangeId===t.target.value}).tickers.sort(function(t,e){var n="",i="1";return t.symbol&&e.symbol&&(n=t.symbol.toUpperCase(),i=e.symbol.toUpperCase()),n<i?-1:n>i?1:0}),this.getNewTicker(this.exchangeId,this.pairs[0].symbol)},t.prototype.pairSelected=function(t,e){this.getNewTicker(t,e)},t.prototype.getBalances=function(t,e){var n=this,i=this.exchanges.find(function(t){return t.id===n.exchangeId}),o=i.balances.find(function(e){return e.currency===t}),r=i.balances.find(function(t){return t.currency===e});this.quoteBalance=0,this.baseBalance=0,o&&(this.quoteBalance=o.available),r&&(this.baseBalance=r.available)},t.prototype.setPriceWithButtons=function(t){var e=this.tradePrice/100,n=this.tradePrice/1e3;switch(t){case"--":this.tradePrice-=e;break;case"-":this.tradePrice-=n;break;case"+":this.tradePrice+=n;break;case"++":this.tradePrice+=e}},t.prototype.getAmountFormat=function(){for(var t=[],e=0;e<this.ticker.info.precision.amount;e++)t.push("0");return"0."+t.join("")},t.prototype.getPriceFormat=function(){for(var t=[],e=0;e<this.ticker.info.precision.price;e++)t.push("0");return"0."+t.join("")},t.prototype.getNewTicker=function(t,n){var i=this;this.isLoading=!0,e.TICKERSERVICE.getTicker(t,n).then(function(e){i.exchangeId=t,i.ticker=e.data,i.tradePrice=+e.data.last,i.getBalances(e.data.quote,e.data.base),i.isLoading=!1}).catch(function(){window.alert("Something went wrong while getting ticker data for "+t+" - "+n),i.isLoading=!1})},t.prototype.setTradePrice=function(t){this.tradePrice=+t.target.value},t.prototype.setTradeAmount=function(t){this.tradeAmount=+t.target.value},t.prototype.roundNumber=function(t,e,n){var i=Math.pow(10,e),o=t*i,r=0;return n?(o=-o,r=-1*Math.round(o)):r=Math.round(o),r/i},t.prototype.setTradeAmountByButton=function(t){var n=0;switch(this.tradeAction){case e.OrderType.LIMITBUY:case e.OrderType.MARKETBUY:this.checkAmounts(n=this.quoteBalance*t/this.tradePrice)&&(this.tradeAmount=(+n*+this.tradePrice-this.getFee(n,this.tradePrice))/this.tradePrice);break;case e.OrderType.LIMITSELL:case e.OrderType.MARKETSELL:this.checkAmounts(n=this.baseBalance*t)&&(this.tradeAmount=(+n*+this.tradePrice-this.getFee(n,this.tradePrice))/this.tradePrice)}},t.prototype.getFee=function(t,n){return this.tradeAction===e.OrderType.LIMITBUY||this.tradeAction===e.OrderType.LIMITSELL?+this.ticker.info.maker*+t*+n:+this.ticker.info.taker*+t*+n},t.prototype.checkAmounts=function(t){return this.ticker.info.limits.amount.min>t?(window.alert("Minimum amount of "+this.ticker.info.limits.amount.min),this.tradeAmount=this.ticker.info.limits.amount.min,!1):!(this.ticker.info.limits.amount.max<t&&(window.alert("Maximum amount of "+this.ticker.info.limits.amount.max),this.tradeAmount=this.ticker.info.limits.amount.max,1))},t.prototype.getSymbol=function(t,n){var i=this.tickers.find(function(t){return t.exchangeId===n.id}).tickers;return e.BALANCESERVICE.getBtcStats(t,i).symbol},t.prototype.refreshBalances=function(){var t=this;this.isLoading=!0,e.BALANCESERVICE.refreshBalances(this.wallets,this.exchanges,this.orders,this.dust).then(function(e){e&&(t.appSetCurrencies(e.conversionrates),t.appSetTickers(e.tickers),t.appSetWallets(e.wallets),t.appSetExchanges(e.exchanges),t.addTotalBalance(e.exchangeTotal+e.walletTotal),t.appSetBalances({overview:e.exchangeTotal+e.walletTotal,exchanges:e.exchangeTotal,wallets:e.walletTotal}),t.appSetOrders(e.orders)),t.isLoading=!1})},t.prototype.addTotalBalance=function(t){var n=this;e.BALANCESERVICE.getTotalBalancesFromStorage().then(function(i){if(t&&t>0){var o=Math.round((new Date).getTime());e.BALANCESERVICE.setTotalBalances(i.concat([[o,t]])),n.appSetTotalBalances(i.concat([[o,t]]))}})},t.prototype.render=function(){var t=this;return[r("ion-header",null,r("ion-toolbar",{color:"dark"},r("ion-buttons",{slot:"start"},r("ion-button",{"icon-only":!0,href:"/settings",padding:!0},r("ion-icon",{name:"options"}))),r("ion-title",{"text-center":!0},"Trade"),r("ion-buttons",{slot:"end"},r("ion-button",{"icon-only":!0,disabled:this.isLoading,onClick:function(){return t.refreshBalances()},padding:!0},r("ion-icon",{name:"refresh",class:this.isLoading?"spin":""})))),this.ticker&&[r("ion-segment",{color:"dark",onIonChange:function(e){return t.step=+e.detail.value}},r("ion-segment-button",{value:"0",checked:0===this.step},"Pair"),r("ion-segment-button",{value:"1",checked:1===this.step},"Price"),r("ion-segment-button",{value:"2",checked:2===this.step},"Action"),r("ion-segment-button",{value:"3",checked:3===this.step},"Amount"),r("ion-segment-button",{value:"4",checked:4===this.step},"Summary"))]),this.ticker?r("ion-content",null,r("ion-list",null,0===this.step&&[r("ion-list-header",{color:"light"},r("ion-title",{"text-center":!0},this.isLoading?r("ion-icon",{name:"sync",class:"spin"}):r("ion-badge",{color:"light"},this.exchangeId," - ",this.ticker.symbol))),r("ion-item-divider",{color:"light"},"Select from all pairs:"),r("ion-item",{lines:"none"},r("ion-label",null,"Select Exchange"),r("select",{onChange:function(e){return t.exchangeSelected(e)}},this.exchanges.filter(function(t){return t.key&&t.secret}).map(function(t){return r("option",{value:t.id},t.id)}))),r("ion-item",{lines:"none"},r("ion-label",null,"Select Pair"),r("select",{onChange:function(e){return t.pairSelected(t.selectedExchange,e.target.value)}},this.pairs.map(function(t){return r("option",{value:t.symbol},t.symbol)}))),r("ion-item-divider",{color:"light"},"Select from holdings:"),this.exchanges.filter(function(t){return t.key&&t.secret}).map(function(e){return[e.balances.filter(function(t){return"BTC"!=t.currency}).map(function(n){return[r("ion-item",{lines:"full",onClick:function(){return t.pairSelected(e.id,t.getSymbol(n,e))}},r("ion-label",{"text-left":!0},e.id),r("ion-label",{"text-right":!0},t.getSymbol(n,e)))]})]})],1===this.step&&r("div",null,r("ion-list-header",{color:"light"},r("ion-title",{"text-center":!0},this.isLoading?r("ion-icon",{name:"sync",class:"spin"}):r("ion-badge",{color:"light"},n.numeral(+this.tradePrice).format(this.getPriceFormat())," ",this.ticker.symbol))),r("app-ohlc",{exchangeId:this.exchangeId,symbol:this.ticker.symbol,altPrice:this.tradePrice,curPrice:this.ticker.last}),r("ion-item",{lines:"none"},r("ion-label",null,"Last price"),r("ion-label",null,r("ion-button",{size:"small",color:"dark",expand:"block","text-right":!0,onClick:function(){return t.tradePrice=t.ticker.last}},n.numeral(+this.ticker.last).format(this.getPriceFormat())," ",this.ticker.symbol))),r("ion-item",{lines:"full"},r("ion-label",null,"Set price:"),r("ion-input",{clearInput:!0,name:"price",type:"number",value:""+this.tradePrice,onInput:function(e){return t.setTradePrice(e)}})),r("ion-grid",null,r("ion-row",null,r("ion-col",null,r("ion-button",{expand:"block",color:"danger",onClick:function(){return t.setPriceWithButtons("--")}},"- -")),r("ion-col",null,r("ion-button",{expand:"block",color:"danger",onClick:function(){return t.setPriceWithButtons("-")}},"-")),r("ion-col",null,r("ion-button",{expand:"block",color:"success",onClick:function(){return t.setPriceWithButtons("+")}},"+")),r("ion-col",null,r("ion-button",{expand:"block",color:"success",onClick:function(){return t.setPriceWithButtons("++")}},"+ +"))))),2===this.step&&[r("ion-list-header",{color:"light"},r("ion-title",{"text-center":!0},r("ion-badge",{color:"light"},this.tradeAction))),r("ion-grid",null,r("ion-row",null,r("ion-col",null,r("ion-button",{expand:"block",color:"success",onClick:function(){return t.tradeAction=e.OrderType.LIMITBUY}},"Limit Buy")),r("ion-col",null,r("ion-button",{expand:"block",color:"danger",onClick:function(){return t.tradeAction=e.OrderType.LIMITSELL}},"Limit Sell"))))],3===this.step&&[r("ion-list-header",{color:"light"},r("ion-title",{"text-center":!0},this.isLoading?r("ion-icon",{name:"sync",class:"spin"}):r("ion-badge",{color:"light"},n.numeral(this.tradeAmount).format(this.getAmountFormat())," ",this.ticker.base))),(this.tradeAction===e.OrderType.LIMITBUY||this.tradeAction===e.OrderType.MARKETBUY)&&r("ion-item",{lines:"none"},r("ion-label",null,"Available ",this.ticker.quote),r("ion-label",null,r("ion-button",{size:"small",color:"dark",expand:"block","text-right":!0,onClick:function(){return t.setTradeAmountByButton(1)}},n.numeral(+this.quoteBalance).format(this.getAmountFormat())))),(this.tradeAction===e.OrderType.LIMITSELL||this.tradeAction===e.OrderType.MARKETSELL)&&r("ion-item",{lines:"none"},r("ion-label",null,"Available ",this.ticker.base),r("ion-label",null,r("ion-button",{size:"small",color:"dark",expand:"block","text-right":!0,onClick:function(){return t.setTradeAmountByButton(1)}},n.numeral(+this.baseBalance).format(this.getAmountFormat())))),r("ion-item",{lines:"full"},r("ion-label",null,"Set Amount:"),r("ion-input",{clearInput:!0,name:"amount",type:"number",value:""+this.tradeAmount,onInput:function(e){return t.setTradeAmount(e)},onBlur:function(){return t.checkAmounts(t.tradeAmount)}})),r("ion-grid",null,r("ion-row",null,r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.1)}},"10%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.2)}},"20%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.3)}},"30%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.4)}},"40%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.5)}},"50%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.6)}},"60%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.7)}},"70%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.8)}},"80%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(.9)}},"90%")),r("ion-col",{"col-6":!0},r("ion-button",{expand:"block",color:"light",onClick:function(){return t.setTradeAmountByButton(1)}},"100%"))))],4===this.step&&[r("ion-list-header",{color:"light"},r("ion-title",{"text-center":!0},r("ion-badge",{color:"light"},"Order summary"))),r("ion-item",{lines:"none"},r("ion-label",null,"Exchange"),r("ion-label",{"text-right":!0},this.ticker.exchange)),r("ion-item",{lines:"none"},r("ion-label",null,"Pair"),r("ion-label",{"text-right":!0},this.ticker.symbol)),r("ion-item",{lines:"full"},r("ion-label",null,"Action"),r("ion-label",{"text-right":!0},this.tradeAction)),r("ion-item",{lines:"none"},r("ion-label",null,"Amount"),r("ion-label",{"text-right":!0},n.numeral(this.tradeAmount).format(this.getAmountFormat())," ",this.ticker.base)),r("ion-item",{lines:"none"},r("ion-label",null,"Price"),r("ion-label",{"text-right":!0},n.numeral(+this.tradePrice).format(this.getPriceFormat())," ",this.ticker.symbol)),r("ion-item",{lines:"full"},r("ion-label",null,"Fee"),r("ion-label",{"text-right":!0},n.numeral(this.getFee(this.tradeAmount,this.tradePrice)).format(this.getPriceFormat())," ",this.ticker.quote)),r("ion-item",{lines:"none"},r("ion-label",null,"Total"),r("ion-label",{"text-right":!0},n.numeral(+this.tradeAmount*+this.tradePrice-this.getFee(this.tradeAmount,this.tradePrice)).format(this.getAmountFormat())," ",this.ticker.quote)),r("ion-button",{expand:"full",color:"success",onClick:function(){return t.executeOrder(t.ticker.symbol,t.tradeAction,t.tradePrice,t.tradeAmount)},disabled:this.isLoading},this.isLoading&&r("ion-icon",{name:"refresh",class:"spin","margin-right":!0})," Execute")])):r("ion-content",{padding:!0},"Loading exchanges...")]},t.prototype.executeOrder=function(t,i,o,r){var a=this;if(window.confirm("Are you sure you want to place this order?")){this.isLoading=!0;var c=this.exchanges.find(function(t){return t.id===a.exchangeId});e.TRADESERVICE.newOrder(c,{pair:t,type:i,price:n.numeral(o).format(this.getPriceFormat()),amount:n.numeral(r).format(this.getAmountFormat()),clientCreds:{key:c.key,secret:c.secret}}).then(function(s){if(s.data.id){window.alert("Placed order:\n\n                      Pair: "+t+"\n\n                      Type: "+i+"\n\n                      Price: "+n.numeral(o).format(a.getPriceFormat())+"\n\n                      amount:"+n.numeral(r).format(a.getAmountFormat()));var l={exchangeId:c.id,pair:t,type:i,status:e.OrderStatus.open,orderId:s.data.id,openPrice:n.numeral(o).format(a.getPriceFormat()),last:n.numeral(a.ticker.last).format(a.getPriceFormat()),closePrice:0,filled:0,remaining:0,amount:n.numeral(r).format(a.getAmountFormat()),fee:a.tradeAction===e.OrderType.LIMITBUY||a.tradeAction===e.OrderType.LIMITSELL?n.numeral(+a.ticker.info.maker*+a.tradeAmount*+a.tradePrice).format(a.getPriceFormat()):n.numeral(+a.ticker.info.taker*+a.tradeAmount*+a.tradePrice).format(a.getPriceFormat()),createdAt:(new Date).getTime()/1e3,updatedAt:(new Date).getTime()/1e3};a.appSetOrders(a.orders.concat([l])),a.isLoading=!1}else a.isLoading=!1,window.alert("Something went wrong while executing the order.")}).catch(function(t){a.isLoading=!1,window.alert("Something went wrong while executing the order: "+t.message)})}},Object.defineProperty(t,"is",{get:function(){return"app-trade"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{baseBalance:{state:!0},dust:{state:!0},exchangeId:{state:!0},exchanges:{state:!0},isLoading:{state:!0},orders:{state:!0},pairs:{state:!0},quoteBalance:{state:!0},selectedExchange:{state:!0},step:{state:!0},store:{context:"store"},ticker:{state:!0},tickers:{state:!0},tradeAction:{state:!0},tradeAmount:{state:!0},tradePrice:{state:!0},wallets:{state:!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return".full{width:100%}"},enumerable:!0,configurable:!0}),t}();t.AppTrade=a,Object.defineProperty(t,"__esModule",{value:!0})});