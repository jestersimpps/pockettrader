/*! Built with http://stenciljs.com */
const{h:e}=window.App;import{d as t,e as r,b as i}from"./chunk-ef98bfe2.js";import{a as o}from"./chunk-f8b49345.js";import{i as s}from"./chunk-6a7807b8.js";import"./chunk-d4e5ef20.js";class n{componentWillLoad(){this.store.mapStateToProps(this,e=>{const{app:{orders:t,tickers:r,exchanges:i,baseCurrency:o}}=e;return{orders:t,tickers:r,exchanges:i,baseCurrency:o}}),this.store.mapDispatchToProps(this,{appSetOrders:s}),this.order=this.orders.find(e=>e.orderId===this.orderId)}render(){return[e("ion-header",null,e("ion-toolbar",{color:"dark"},e("ion-buttons",{slot:"start"},e("ion-back-button",{defaultHref:"/orders"})),e("ion-title",{"text-center":!0},this.order.pair),e("ion-buttons",{slot:"end"},e("ion-button",{"icon-only":!0,disabled:this.isLoading,onClick:()=>this.reloadOrder(),padding:!0},e("ion-icon",{name:"refresh",class:this.isLoading?"spin":""}))))),e("ion-content",null,e("ion-list",null,e("app-ohlc",{exchangeId:this.order.exchangeId,symbol:this.order.pair,altPrice:this.order.openPrice,curPrice:this.order.last}),e("ion-item",{lines:"none"},e("ion-label",null,"Last/Open Price"),e("ion-label",{"text-right":!0,slot:"end"},e("b",{style:{color:100*this.order.last/this.order.openPrice-100>0?"#10dc60":"#f53d3d"}},100*this.order.last/this.order.openPrice-100>0?"+"+o(100*this.order.last/this.order.openPrice-100).format("0,0.00")+" %":o(100*this.order.last/this.order.openPrice-100).format("0,0.00")+" %"))),e("ion-item",{lines:"none"},e("ion-label",null,"Type"),e("ion-label",{"text-right":!0,slot:"end"},this.order.type)),e("ion-item",{lines:"none"},e("ion-label",null,"Exchange"),e("ion-label",{"text-right":!0,slot:"end"},this.order.exchangeId)),e("ion-item",{lines:"none"},e("ion-label",null,"Pair"),e("ion-label",{"text-right":!0,slot:"end"},this.order.pair)),e("ion-item",{lines:"full"},e("ion-label",null,"Status"),e("ion-badge",{color:"dark","text-right":!0,slot:"end"},this.order.status)),e("ion-item",{lines:"none"},e("ion-label",null,"Open Price"),e("ion-label",{"text-right":!0,slot:"end"},this.order.openPrice?o(this.order.openPrice).format("0,0.00000000"):"-")),e("ion-item",{lines:"none"},e("ion-label",null,"Last Price"),e("ion-label",{"text-right":!0,slot:"end"},this.order.last?o(this.order.last).format("0,0.00000000"):"-")),e("ion-item",{lines:"none"},e("ion-label",null,"Amount"),e("ion-label",{"text-right":!0,slot:"end"},this.order.amount," ",this.order.base)),e("ion-item",{lines:"full"},e("ion-label",null,"Fee"),e("ion-label",{"text-right":!0,slot:"end"},this.order.fee?o(this.order.fee).format("0,0.00000000"):"-")),e("ion-item",{lines:"none"},e("ion-label",null,"Open Total"),e("ion-label",{"text-right":!0,slot:"end"},this.order.openPrice?o(this.order.openPrice*this.order.amount-this.order.fee).format("0,0.00000000"):"-")),e("ion-item",{lines:"none"},e("ion-label",null,"Last Total"),e("ion-label",{"text-right":!0,slot:"end"},this.order.last?o(this.order.last*this.order.amount-this.order.fee).format("0,0.00000000"):"-")),e("ion-item",{lines:"none"},e("ion-label",null,this.order.status===t.open&&"Last - Open total",this.order.status===t.filled&&"Last - Fill total",this.order.status===t.closed&&"Last - Fill total",this.order.status===t.cancelled&&"Last/Open total"),e("ion-label",{"text-right":!0,slot:"end"},this.order.last?o(this.order.last*this.order.amount-this.order.openPrice*this.order.amount-2*this.order.fee).format("0,0.00000000"):"-")),this.order.status===t.open&&e("ion-button",{color:"danger",expand:"full",disabled:this.isLoading,onClick:()=>this.cancelOrder()},this.isLoading&&e("ion-icon",{name:"refresh",class:"spin","margin-right":!0}),"Cancel Order"),e("ion-nav-pop",null,e("ion-button",{color:"danger",expand:"full",disabled:this.isLoading,onClick:()=>this.deleteOrder()},this.isLoading&&e("ion-icon",{name:"refresh",class:"spin","margin-right":!0}),"Delete Order"))))]}cancelOrder(){if(window.confirm("Are you sure you want to cancel this order?")){this.isLoading=!0;let e=this.exchanges.find(e=>e.id===this.order.exchangeId);r.cancelOrder(e,this.order.orderId,this.order.pair).then(()=>{window.alert("Order cancelled"),this.order.status=t.cancelled,this.appSetOrders(this.orders),this.isLoading=!1}).catch(e=>{this.isLoading=!1,window.alert(`Something went wrong while canceling the order: ${e.message}`)})}}deleteOrder(){this.isLoading=!0;let e=this.orders.filter(e=>e.orderId!==this.orderId);this.appSetOrders(e),this.isLoading=!1}reloadOrder(){this.isLoading=!0;let e=this.exchanges.find(e=>e.id===this.order.exchangeId),o=[];i.getTickers(this.order.exchangeId).then(i=>(o=i.data,r.getOrder(e,this.order.orderId,this.order.pair).then(e=>{let r=e.data,i=this.orders.find(e=>e.orderId===r.id),s=o.find(e=>e.symbol===i.pair);i.filled=r.filled,i.remaining=r.remaining,i.last=s.last,0==+r.remaining&&(i.status=t.filled),this.isLoading=!1,this.appSetOrders(this.orders)}).catch(e=>{window.alert(`Something went wrong while fetching the orderbook: ${e.message}`),this.isLoading=!1}))).catch(e=>{window.alert(`Error fetching ticker data: ${e.message}`),this.isLoading=!1})}static get is(){return"app-order"}static get properties(){return{baseCurrency:{state:!0},exchanges:{state:!0},isLoading:{state:!0},order:{state:!0},orderId:{type:String,attr:"order-id"},orders:{state:!0},store:{context:"store"},tickers:{state:!0}}}static get style(){return""}}export{n as AppOrder};